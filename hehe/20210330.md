# ES module in Node.ts

## åŠ¨æœº
- å°Šé‡æ ‡å‡†
  - Node 14+ åŸç”Ÿæ”¯æŒ (stable)
  - ES module è¦æ±‚æ–‡ä»¶æ‰©å±•åï¼ŒæŠ›å¼ƒéšå¼ index ([Mandatory file extensions](https://nodejs.org/api/esm.html#esm_mandatory_file_extensions))
- 10 Things I Regret About Node.js â€” Ryan Dahl
  - #7: Require without the extension

## ç†æƒ³çŠ¶æ€
- æ‰€æœ‰é¡¹ç›®ä¿æŒä¸€è‡´ï¼Œ`"import/extensions": ["error", "always"]`
  - ä¾‹ï¼š`scripts/build.js` ä½¿ç”¨ native ES module ~~tsc~~ ~~ts-node~~
  - ä¾‹ï¼š`api/server.ts` ä½¿ç”¨ ES module + tsc
- åŸåˆ™ä¸Šï¼Œä¸é¦–å…ˆä½¿ç”¨å¥‡æŠ€æ·«å·§ï¼Œä¸é¦–å…ˆåˆ¶é€ è½®å­
- åŸåˆ™ä¸Šï¼Œä¸ä½¿ç”¨ `.cjs`/`.mjs` (æ»‘ç¨½)
- æœ€å¥½èƒ½ï¼š`import {sum} from './math.ts'`
- ä¹Ÿè¡Œå§ï¼š`import {sum} from './math'` transpile to `import {sum} from './math.js'`

## å¿ƒè·¯å†ç¨‹
- å·¥å…·é“¾æ”¯æŒ import `.ts` (Webpack/Rollup/esbuild/metro/ESLint)
- tsc ä¸æ”¯æŒ
  - æœ€å¤šè®©ä½ å†™ `.js`
  - tsc: `An import path cannot end with a '.ts' extension. Consider importing './sum' instead` (TS2691)
- âœ… é‚£å°± import jsï¼Œæ¶å¿ƒå°±æ¶å¿ƒç‚¹
  - `import type {FooType} from './types.js' // types.d.ts` ğŸ¤®
- âŒ ä¸å®Œç¾
  - å…¶ä»–å·¥å…·è§£æå¸¦æ‰©å±•çš„å¼•ç”¨ï¼Œä¾æ®çš„æ˜¯ **æ–‡ä»¶æ˜¯å¦å­˜åœ¨**ï¼Œä¹Ÿå°±ä¸èƒ½ `import` **ä¸å­˜åœ¨çš„** `math.js`ï¼ˆæºæ–‡ä»¶ä¸º `math.ts`ï¼‰
    - ~~metro~~
    - ~~ts-node~~
    - ~~vite // esbuild, rollup~~
    - ä¹Ÿè®¸å¯ä»¥ hackï¼Œä½†æ˜¯è¿èƒŒäº†ç¬¬ä¸€åŸåˆ™
  - ä¹Ÿå°±ä¸å¯èƒ½è¾¾æˆï¼šæ‰€æœ‰é¡¹ç›®ä¿æŒä¸€è‡´

## å…¶ä»–å¯èƒ½
- [ttypescript](https://github.com/cevek/ttypescript)/[tsc-silent](https://github.com/evolution-gaming/tsc-silent)/... // ç¼ºä¹ç»´æŠ¤ï¼Œæ—  IDE æ”¯æŒ
- @ts-ignore // æ— æ³•æ¥å—ï¼Œæ¯ä¸ª import ä¸Šé¢éƒ½å¾—åŠ 
- ä¸å†™æ‰©å±•åï¼Œçœ‹çœ‹ tsc (`"module": "esnext"`) ä¼šä¸ä¼šå¸®æˆ‘ä»¬åŠ ä¸Š // æ²¡æœ‰+ä¸ä¼šæœ‰ï¼š"it is not our goal" ğŸ‚
- ä¸å†™æ‰©å±•åï¼Œuse ncc/Rollup/esbuild as node bundler // ä»ç„¶éœ€è¦ tsc åšçº¦æŸï¼Œå†µä¸”æˆ‘å·²ç»ç”¨äº† nft

## ç»“è®º
- é€‰ç”¨ **æ¸è¿›å¼æ¶å¿ƒ**
  - çº¯ Node.tsï¼Œ`import .js`
  - Next.js/Vite/React-Nativeï¼Œçœç•¥æ‰©å±•
- ES module æ ‡å‡†æ¨è¿›å¤ªæ…¢æµªè´¹æ—¶é—´
- ES module é‡‡çº³ç‡å ªå¿§
  - å¤§éƒ¨åˆ†å¸¸ç”¨é¡¹ç›®éƒ½ä¼šæä¾› esm æ–‡ä»¶ï¼Œå¹¶é‡‡ç”¨ `"module"` ç”³æ˜ entry point ä¾› bundler é€‰ç”¨
  - ä½† Node.js å®é™…ä¸Š[å¹¶ä¸ respect](https://nodejs.org/docs/latest/api/packages.html#packages_dual_commonjs_es_module_packages) top-level `"module"` å­—æ®µ
  - ä½ å¾—ç”¨ `"type": "module"` (æˆ–è®¸è¿˜å¾—ç”¨ [conditional exports](https://nodejs.org/api/packages.html#packages_conditional_exports))
  - ç”±äº Node.js å¯ä»¥æ··ç”¨ CommonJS/ES moduleï¼Œç¤¾åŒºå¯èƒ½ä¹Ÿå°±æ²¡åŠ¨åŠ›é‡‡çº³ï¼ˆåˆä¸æ˜¯ä¸èƒ½ç”¨ï¼‰
- å°†è¿›å…¥æ¼«é•¿çš„åŠæ®–æ°‘åœ°åŠå°å»ºç¤¾ä¼š
- long live **Compile to JS**
- Deno ğŸ‘€
